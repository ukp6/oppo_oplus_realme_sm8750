name: åŠ é€Ÿç‰ˆæ„å»º 6.6.89 æ¬§åŠ çœŸOKIå†…æ ¸ (å·²ä¼˜åŒ–ä¿®å¤ç‰ˆ)

env:
  TZ: Asia/Shanghai
  ANDROID_VERSION: 'android15'
  KERNEL_VERSION: '6.6'
  KERNEL_NAME: 'android15-8-g29d86c5fc9dd-abogki428889875-4k'

on:
  workflow_dispatch:
    inputs:
      ksu_type:
        description: 'KernelSUåˆ†æ”¯(SukiSU Ultra/ReSukiSU/KernelSU Next/MKSU/KSU(åŸç‰ˆ)/æ— å†…ç½®KSU,é»˜è®¤ReSukiSU)'
        required: true
        type: choice
        default: 'resukisu'
        options:
          - 'sukisu'
          - 'resukisu'
          - 'ksunext'
          - 'mksu'
          - 'ksu'
          - 'none'
      susfs_enable:
        description: 'æ˜¯å¦å¼€å¯susfs(ç”¨äºå¢å¼ºéšè—ç¯å¢ƒæŒ‚è½½åŠŸèƒ½; å¯èƒ½è½»å¾®å¢åŠ è€—ç”µï¼Œä¸Šæ¸¸æ›´æ–°å¯¼è‡´ä¸ç¨³å®šæ—¶æˆ–ä¸éœ€è¦å¯å…³é—­)'
        required: true
        type: boolean
        default: 'true'
      kpm_enable:
        description: 'æ˜¯å¦å¼€å¯kpm(builtin-ä½¿ç”¨(re)sukisuå†…ç½®kpm, kpn-ä½¿ç”¨ç‹¬ç«‹kpmå®ç°(æ”¯æŒä»»æ„KSU/é¢å…·ç¯å¢ƒ); ä¸éœ€è¦å¯ä¿æŒé»˜è®¤å…³é—­)'
        required: true
        type: choice
        default: 'false'
        options:
          - 'false'
          - 'builtin'
          - 'kpn'
      lz4_enable:
        description: 'æ˜¯å¦å®‰è£… lz4 1.10.0+zstd 1.5.7 è¡¥ä¸åŠ LZ4KD è¡¥ä¸'
        required: true
        type: boolean
        default: 'true'
      lz4kd_enable:
        description: 'æ˜¯å¦å®‰è£… LZ4KD è¡¥ä¸(è‹¥å·²å¼€å¯lz4+zstdè¡¥ä¸åˆ™å¯ä¸å¼€å¯)'
        required: true
        type: boolean
        default: 'false'
      bbr_enable:
        description: "æ˜¯å¦å¯ç”¨bbrç®—æ³•(ä¼˜åŒ–ä¸Šè¡Œæ•°æ®,å¯¹æ‰‹æœºæ—¥ç”¨æ— å¤ªå¤§æ„ä¹‰ç”šè‡³å¯èƒ½è´Ÿä¼˜åŒ–;falseå…³é—­,trueä»…åŠ å…¥ç®—æ³•,defaultå¯ç”¨ç®—æ³•å¹¶è®¾ä¸ºé»˜è®¤)"
        required: true
        type: choice
        default: 'false'
        options:
          - 'false'
          - 'true'
          - 'default'
      better_net:
        description: 'æ˜¯å¦å¼€å¯ç½‘ç»œåŠŸèƒ½æ‹“å±•é…ç½®(ç”¨äºä¸ºipsetåŠéœ€è¦iptablesç­‰é«˜çº§ç½‘ç»œåŠŸèƒ½å†…æ ¸æ”¯æŒçš„ç¨‹åºæä¾›æ”¯æŒ)'
        required: true
        type: boolean
        default: 'false'
      adios_enable:
        description: 'æ˜¯å¦å¯ç”¨ADIOS IOè°ƒåº¦å™¨æ”¯æŒ(æå‡IOè¯»å†™æ€§èƒ½)'
        required: true
        type: boolean
        default: 'true'
      rekernel_enable:
        description: 'æ˜¯å¦å¯ç”¨Re-Kernelæ”¯æŒ(ä¸Freezer/NoActiveç­‰è½¯ä»¶é…åˆ, æå‡åº”ç”¨å†»ç»“èƒ½åŠ›)'
        required: true
        type: boolean
        default: 'false'
      baseband_guard:
        description: 'æ˜¯å¦å¼€å¯å†…æ ¸çº§åŸºå¸¦ä¿æŠ¤(é˜»æ­¢ä¸€åˆ‡å¯¹éç”¨æˆ·åˆ†åŒºçš„å†™å…¥ï¼Œæœ‰æ•ˆé˜²æ­¢æ ¼æœº)'
        required: true
        type: boolean
        default: 'true'
      ccache_debug:
        description: 'æ˜¯å¦ä¸Šä¼  Ccacheè°ƒè¯•æ—¥å¿—(ç”¨äºè°ƒè¯•, æ— éœ€è¦ä¸å¿…å¼€å¯)'
        required: true
        type: boolean
        default: 'false'
      kernel_suffix:
        description: 'å†…æ ¸åç¼€(ç•™ç©ºé»˜è®¤,å¼€å¤´åˆ«åŠ è¿å­—ç¬¦,å‹¿åŠ ç©ºæ ¼ç­‰å½±å“æŒ‡ä»¤è¿è¡Œçš„ä¿ç•™å­—ç¬¦)'
        required: false
        type: string
        default: ''

jobs:
 build:
  runs-on: ubuntu-latest
  outputs:
    ksuver: ${{ steps.ksu_version.outputs.ksuver }}
  steps:
    # ------------------------------------------------------------
    # 1. å®‰è£…ç¼–è¯‘ä¾èµ–ï¼ˆå®Œæ•´å·¥å…·é“¾ï¼‰
    # ------------------------------------------------------------
    - name: å®‰è£…ç¯å¢ƒä¾èµ–+åˆå§‹åŒ–æºç ä»“åº“åŠllvm-Clang18å·¥å…·é“¾
      run: |
        set -euo pipefail
        rm -rf kernel_workspace
        mkdir kernel_workspace
        cd kernel_workspace

        sudo apt-mark hold firefox
        sudo apt-mark hold libc-bin
        sudo apt purge man-db
        sudo rm -rf /var/lib/man-db/auto-update
        sudo apt update
        sudo apt-get install -y --no-install-recommends \
          binutils python-is-python3 libssl-dev libelf-dev ccache \
          make git bc flex bison gcc-aarch64-linux-gnu

        echo "æ­£åœ¨å…‹éš†æºç ä»“åº“..."
        aria2c -s16 -x16 -k1M \
          "https://github.com/cctv18/android_kernel_common_oneplus_sm8750/archive/refs/heads/oneplus/sm8750_v_16.0.0_oneplus_13_6.6.89.zip" \
          -o common.zip
        unzip -q common.zip
        mv "android_kernel_common_oneplus_sm8750-oneplus-sm8750_v_16.0.0_oneplus_13_6.6.89" common
        rm -f common.zip

        echo "æ­£åœ¨å…‹éš†llvm-clang18å·¥å…·é“¾..."
        mkdir -p clang18
        aria2c -s16 -x16 -k1M \
          "https://github.com/cctv18/oneplus_sm8650_toolchain/releases/download/LLVM-Clang18-r510928/clang-r510928.zip" \
          -o clang.zip
        unzip -q clang.zip -d clang18
        rm -f clang.zip

        echo "æ­£åœ¨å»é™¤ ABI ä¿æŠ¤ & å»é™¤ dirty åç¼€..."
        rm -f common/android/abi_gki_protected_exports_* 2>/dev/null || true
        for f in common/scripts/setlocalversion; do
          sed -i 's/ -dirty//g' "$f"
          sed -i '$i res=$(echo "$res" | sed '\''s/-dirty//g'\'')' "$f"
        done

        echo "æ‰€æœ‰æºç åŠllvm-Clang18å·¥å…·é“¾åˆå§‹åŒ–å®Œæˆï¼"

    # ------------------------------------------------------------
    # 2. ccache ç¯å¢ƒå˜é‡ & ç¼“å­˜é…ç½®
    # ------------------------------------------------------------
    - name: é…ç½®ccacheç›®å½•
      run: |
        echo "CCACHE_DIR=$HOME/.ccache_6.6.89" >> $GITHUB_ENV
        echo "CCACHE_MAXSIZE=3G" >> $GITHUB_ENV
        echo "å½“å‰ç£ç›˜ç©ºé—´ï¼š"
        df -h

    - name: è½½å…¥ ccache ç¼“å­˜
      uses: actions/cache@v4
      id: ccache-restore
      with:
        path: ${{ env.CCACHE_DIR }}
        key: ccache-6.6.89-${{ runner.os }}-${{ github.run_id }}
        restore-keys: |
          ccache-6.6.89-${{ runner.os }}-
          ccache-6.6.89-

    - name: åˆå§‹åŒ–å¹¶é…ç½®ccache
      run: |
        mkdir -p "${{ env.CCACHE_DIR }}"
        cat > "${{ env.CCACHE_DIR }}/ccache.conf" << EOF
        max_size = 3G
        compression = true
        compression_level = 6
        direct = true
        sloppiness = file_stat_matches,include_file_ctime,include_file_mtime,pch_defines,file_macro,time_macros
        hash_dir = false
        hardlink = true
        basedir = ${{ github.workspace }}
        EOF
        ccache -z
        ccache -sv

    # ------------------------------------------------------------
    # 3. æ·»åŠ  KernelSUï¼ˆæ‰€æœ‰åˆ†æ”¯å·²ä¿®å¤ï¼‰
    # ------------------------------------------------------------
    - name: æ·»åŠ KernelSU
      id: ksu_version
      run: |
        set -euo pipefail
        cd kernel_workspace
        # é»˜è®¤å€¼
        echo "KSUVER=0" >> $GITHUB_ENV
        echo "ksuver=0" >> $GITHUB_OUTPUT

        case "${{ github.event.inputs.ksu_type }}" in
          sukisu)
            echo "æ­£åœ¨é…ç½®SukiSU Ultra..."
            curl -LSs "https://raw.githubusercontent.com/ShirkNeko/SukiSU-Ultra/refs/heads/main/kernel/setup.sh" | bash -s builtin
            cd KernelSU
            GIT_COMMIT_HASH=$(git rev-parse --short=8 HEAD)
            echo "å½“å‰æäº¤å“ˆå¸Œ: $GIT_COMMIT_HASH"

            # ä½¿ç”¨ awk è·å– KSU_API_VERSIONï¼ˆé¿å… grep -Pï¼‰
            get_ksu_api_version() {
              local max_retries=5
              local retry=0
              while [ $retry -lt $max_retries ]; do
                local version=$(curl -s --max-time 10 \
                  "https://raw.githubusercontent.com/ShirkNeko/SukiSU-Ultra/main/kernel/Makefile" | \
                  awk -F':=' '/KSU_VERSION_API[[:space:]]*:=/ {gsub(/[[:space:]]/, "", $2); print $2}')
                if [ -n "$version" ] && [[ "$version" =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
                  echo "$version"
                  return 0
                fi
                retry=$((retry + 1))
                echo "âš ï¸ å°è¯• $retry/$max_retries è·å– KSU ç‰ˆæœ¬..." >&2
                sleep 2
              done
              echo "3.1.7"  # é»˜è®¤ç‰ˆæœ¬
              return 1
            }
            KSU_API_VERSION=$(get_ksu_api_version)
            echo "KSU_API_VERSION=$KSU_API_VERSION" >> $GITHUB_ENV

            # ç”Ÿæˆç‰ˆæœ¬å®šä¹‰ï¼ˆæ›´ç¨³å¥çš„æ’å…¥ï¼‰
            VERSION_DEF="define get_ksu_version_full\nv\$$1-${GIT_COMMIT_HASH}@cctv18\nendef\n\nKSU_VERSION_API := ${KSU_API_VERSION}\nKSU_VERSION_FULL := v${KSU_API_VERSION}-${GIT_COMMIT_HASH}@cctv18"
            if [ -f kernel/Kbuild ]; then
              # å¦‚æœå·²æœ‰ REPO_OWNER è¡Œï¼Œåœ¨å…¶åæ’å…¥ï¼›å¦åˆ™è¿½åŠ 
              if grep -q "^REPO_OWNER :=" kernel/Kbuild; then
                sed -i "/^REPO_OWNER :=/a\\$VERSION_DEF" kernel/Kbuild
              else
                echo -e "$VERSION_DEF" >> kernel/Kbuild
              fi
            fi

            # è®¡ç®— KSU ç‰ˆæœ¬å·ï¼ˆåŸºäº HEAD æäº¤æ•°ï¼‰
            commit_count=$(git rev-list --count HEAD 2>/dev/null || echo 37185)
            KSU_VERSION=$((commit_count + 37185))
            echo "KSUVER=$KSU_VERSION" >> $GITHUB_ENV
            echo "ksuver=$KSU_VERSION" >> $GITHUB_OUTPUT
            cd ..
            ;;

          resukisu)
            echo "æ­£åœ¨é…ç½®ReSukiSU..."
            curl -LSs "https://raw.githubusercontent.com/ReSukiSU/ReSukiSU/refs/heads/main/kernel/setup.sh" | bash -s main
            echo 'CONFIG_KSU_FULL_NAME_FORMAT="%TAG_NAME%-%COMMIT_SHA%@cctv18"' >> ./common/arch/arm64/configs/gki_defconfig
            cd KernelSU
            commit_count=$(git rev-list --count HEAD 2>/dev/null || echo 30700)
            KSU_VERSION=$((commit_count + 30700))
            echo "KSUVER=$KSU_VERSION" >> $GITHUB_ENV
            echo "ksuver=$KSU_VERSION" >> $GITHUB_OUTPUT
            cd ..
            ;;

          ksunext)
            echo "æ­£åœ¨é…ç½®KernelSU Next..."
            curl -LSs "https://raw.githubusercontent.com/pershoot/KernelSU-Next/refs/heads/dev/kernel/setup.sh" | bash -s dev
            cd KernelSU-Next
            rm -rf .git
            # å®‰å…¨è·å–æäº¤æ€»æ•°
            total_pages=$(curl -sI "https://api.github.com/repos/pershoot/KernelSU-Next/commits?sha=dev&per_page=1" | \
              grep -i "link:" | sed -n 's/.*page=\([0-9]*\)>; rel="last".*/\1/p')
            total_commits=${total_pages:-1}
            KSU_VERSION=$((total_commits + 30000))
            echo "KSUVER=$KSU_VERSION" >> $GITHUB_ENV
            echo "ksuver=$KSU_VERSION" >> $GITHUB_OUTPUT
            # æ›¿æ¢ç‰ˆæœ¬å·ï¼ˆæ–‡ä»¶å­˜åœ¨æ‰æ“ä½œï¼‰
            [ -f kernel/Kbuild ] && sed -i "s/KSU_VERSION_FALLBACK := 1/KSU_VERSION_FALLBACK := $KSU_VERSION/g" kernel/Kbuild
            KSU_GIT_TAG=$(curl -sL "https://api.github.com/repos/KernelSU-Next/KernelSU-Next/tags" | \
              grep -o '"name": *"[^"]*"' | head -n1 | sed 's/"name": "//;s/"//')
            [ -n "$KSU_GIT_TAG" ] && [ -f kernel/Kbuild ] && \
              sed -i "s/KSU_VERSION_TAG_FALLBACK := v0.0.1/KSU_VERSION_TAG_FALLBACK := $KSU_GIT_TAG/g" kernel/Kbuild
            cd ../common/drivers/kernelsu
            wget -q https://github.com/cctv18/oppo_oplus_realme_sm8750/raw/refs/heads/main/other_patch/apk_sign.patch
            patch -p2 -N -F 3 < apk_sign.patch || echo "âš ï¸ apk_signè¡¥ä¸åº”ç”¨å¤±è´¥ï¼Œç»§ç»­"
            cd ../../..
            ;;

          mksu)
            echo "æ­£åœ¨é…ç½® MKSU..."
            curl -LSs "https://raw.githubusercontent.com/5ec1cff/KernelSU/refs/heads/main/kernel/setup.sh" | bash -s main
            cd KernelSU
            total_pages=$(curl -sI "https://api.github.com/repos/5ec1cff/KernelSU/commits?sha=main&per_page=1" | \
              grep -i "link:" | sed -n 's/.*page=\([0-9]*\)>; rel="last".*/\1/p')
            total_commits=${total_pages:-1}
            KSU_VERSION=$((total_commits + 30000))
            echo "KSUVER=$KSU_VERSION" >> $GITHUB_ENV
            echo "ksuver=$KSU_VERSION" >> $GITHUB_OUTPUT
            [ -f kernel/Kbuild ] && sed -i "s/DKSU_VERSION=16/DKSU_VERSION=${KSU_VERSION}/" kernel/Kbuild
            cd ..
            ;;

          ksu)
            echo "æ­£åœ¨é…ç½®åŸç‰ˆ KernelSU..."
            curl -LSs "https://raw.githubusercontent.com/tiann/KernelSU/refs/heads/main/kernel/setup.sh" | bash -s main
            cd KernelSU
            total_pages=$(curl -sI "https://api.github.com/repos/tiann/KernelSU/commits?sha=main&per_page=1" | \
              grep -i "link:" | sed -n 's/.*page=\([0-9]*\)>; rel="last".*/\1/p')
            total_commits=${total_pages:-1}
            KSU_VERSION=$((total_commits + 30000))
            echo "KSUVER=$KSU_VERSION" >> $GITHUB_ENV
            echo "ksuver=$KSU_VERSION" >> $GITHUB_OUTPUT
            [ -f kernel/Kbuild ] && sed -i "s/DKSU_VERSION=16/DKSU_VERSION=${KSU_VERSION}/" kernel/Kbuild
            cd ..
            ;;

          none)
            echo "å·²é€‰æ‹©æ— å†…ç½®KernelSUæ¨¡å¼ï¼Œè·³è¿‡KernelSUé…ç½®..."
            echo "KSUVER=0" >> $GITHUB_ENV          # åŠ è¿™è¡Œ
            echo "ksuver=0" >> $GITHUB_OUTPUT       # åŠ è¿™è¡Œ
            ;;
        esac

    # ------------------------------------------------------------
    # 4. åº”ç”¨ KernelSU & SUSFS è¡¥ä¸ï¼ˆå·²å¢å¼ºç¨³å®šæ€§ï¼‰
    # ------------------------------------------------------------
    - name: åº”ç”¨ KernelSU & SUSFS è¡¥ä¸
      if: inputs.susfs_enable
      run: |
        set -euo pipefail
        cd kernel_workspace
        KSU_TYPE="${{ github.event.inputs.ksu_type }}"
        ANDROID_VER="${{ env.ANDROID_VERSION }}"
        KERNEL_VER="${{ env.KERNEL_VERSION }}"

        git clone --depth=1 https://gitlab.com/simonpunk/susfs4ksu.git -b "gki-${ANDROID_VER}-${KERNEL_VER}"
        wget -q https://github.com/cctv18/oppo_oplus_realme_sm8750/raw/refs/heads/main/other_patch/69_hide_stuff.patch -O ./common/69_hide_stuff.patch

        # å¤åˆ¶é€šç”¨æ–‡ä»¶
        cp ./susfs4ksu/kernel_patches/50_add_susfs_in_gki-${ANDROID_VER}-${KERNEL_VER}.patch ./common/
        cp ./susfs4ksu/kernel_patches/fs/* ./common/fs/ 2>/dev/null || true
        cp ./susfs4ksu/kernel_patches/include/linux/* ./common/include/linux/ 2>/dev/null || true

        cd common
        # åº”ç”¨ä¸»è¡¥ä¸ï¼ˆä½¿ç”¨æ¨¡ç³ŠåŒ¹é…ï¼Œä½†è®°å½•ç»“æœï¼‰
        if patch -p1 -N -F 3 --dry-run < "50_add_susfs_in_gki-${ANDROID_VER}-${KERNEL_VER}.patch" >/dev/null 2>&1; then
          patch -p1 -N -F 3 < "50_add_susfs_in_gki-${ANDROID_VER}-${KERNEL_VER}.patch" && echo "âœ“ SUSFSä¸»è¡¥ä¸åº”ç”¨æˆåŠŸ" || echo "âš ï¸ SUSFSä¸»è¡¥ä¸åº”ç”¨å¤±è´¥"
        else
          echo "âš ï¸ SUSFSä¸»è¡¥ä¸æ— æ³•åº”ç”¨ï¼Œè·³è¿‡"
        fi

        # æ ¹æ® KSU ç±»å‹å¤„ç†ç‰¹å®šè¡¥ä¸
        case "$KSU_TYPE" in
          sukisu|resukisu|ksunext|mksu|ksu)
            # å¤„ç† 69_hide_stuff.patch
            if patch -p1 -N -F 3 --dry-run < "69_hide_stuff.patch" >/dev/null 2>&1; then
              patch -p1 -N -F 3 < "69_hide_stuff.patch" && echo "âœ“ 69_hide_stuffè¡¥ä¸åº”ç”¨æˆåŠŸ" || echo "âš ï¸ 69_hide_stuffè¡¥ä¸åº”ç”¨å¤±è´¥"
            else
              echo "âš ï¸ 69_hide_stuffè¡¥ä¸æ— æ³•åº”ç”¨ï¼Œè·³è¿‡"
            fi

            # ç‰¹å®šä¿®å¤ï¼ˆä»…å¯¹resukisuï¼‰
            if [ "$KSU_TYPE" = "resukisu" ]; then
              if [ -f fs/proc/task_mmu.c ]; then
                if ! grep -q "struct vm_area_struct \*vma = find_vma" fs/proc/task_mmu.c; then
                  sed -i 's|vma = find_vma(mm, addr)|struct vm_area_struct *vma = find_vma(mm, addr)|g' fs/proc/task_mmu.c
                fi
              fi
            fi
            ;;

          *)
            echo "æ— éœ€åº”ç”¨KSUç›¸å…³SUSFSè¡¥ä¸"
            ;;
        esac

        # é’ˆå¯¹ MKSU / åŸç‰ˆ KSU çš„ç‰¹æ®Šè¡¥ä¸
        if [ "$KSU_TYPE" = "mksu" ] || [ "$KSU_TYPE" = "ksu" ]; then
          cd ../KernelSU
          cp ../susfs4ksu/kernel_patches/KernelSU/10_enable_susfs_for_ksu.patch .
          # ä¸ç¯¡æ”¹è¡¥ä¸å†…å®¹ï¼Œç›´æ¥åº”ç”¨ï¼Œå¤±è´¥åˆ™å¿½ç•¥
          if patch -p1 -N -F 3 --dry-run < 10_enable_susfs_for_ksu.patch >/dev/null 2>&1; then
            patch -p1 -N -F 3 < 10_enable_susfs_for_ksu.patch && echo "âœ“ SUSFS for KSU è¡¥ä¸åº”ç”¨æˆåŠŸ" || echo "âš ï¸ SUSFS for KSU è¡¥ä¸åº”ç”¨å¤±è´¥"
          else
            echo "âš ï¸ SUSFS for KSU è¡¥ä¸æ— æ³•åº”ç”¨ï¼Œè·³è¿‡"
          fi
          if [ "$KSU_TYPE" = "mksu" ]; then
            wget -q https://github.com/cctv18/oppo_oplus_realme_sm8750/raw/refs/heads/main/other_patch/mksu_supercalls.patch
            patch -p1 -N -F 3 < mksu_supercalls.patch || echo "âš ï¸ mksu_supercallsè¡¥ä¸åº”ç”¨å¤±è´¥"
          fi
          cd ../common
        fi

    # ------------------------------------------------------------
    # 5. åº”ç”¨LZ4/ZSTDè¡¥ä¸ï¼ˆå¢åŠ è¡¥ä¸å­˜åœ¨æ€§æ£€æŸ¥ï¼‰
    # ------------------------------------------------------------
    - name: åº”ç”¨lz4 1.10.0 & zstd 1.5.7è¡¥ä¸
      if: inputs.lz4_enable
      run: |
        set -euo pipefail
        cd kernel_workspace
        if [ ! -d "oppo_oplus_realme_sm8750" ]; then
          git clone --depth=1 https://github.com/cctv18/oppo_oplus_realme_sm8750.git
        fi
        cd common
        [ -f ../oppo_oplus_realme_sm8750/zram_patch/001-lz4.patch ] && \
          patch -p1 -N -F 3 < ../oppo_oplus_realme_sm8750/zram_patch/001-lz4.patch || echo "âš ï¸ lz4è¡¥ä¸ä¸å­˜åœ¨æˆ–å·²åº”ç”¨"
        cp ../oppo_oplus_realme_sm8750/zram_patch/lz4armv8.S ./lib/ 2>/dev/null || true
        [ -f ../oppo_oplus_realme_sm8750/zram_patch/002-zstd.patch ] && \
          patch -p1 -N -F 3 < ../oppo_oplus_realme_sm8750/zram_patch/002-zstd.patch || echo "âš ï¸ zstdè¡¥ä¸ä¸å­˜åœ¨æˆ–å·²åº”ç”¨"

    - name: åº”ç”¨ lz4kd è¡¥ä¸
      if: inputs.lz4kd_enable
      run: |
        set -euo pipefail
        cd kernel_workspace
        if [ ! -d "SukiSU_patch" ]; then
          git clone --depth=1 https://github.com/ShirkNeko/SukiSU_patch.git
        fi
        cd common
        cp -r ../SukiSU_patch/other/zram/lz4k/include/linux/* ./include/linux/ 2>/dev/null || true
        cp -r ../SukiSU_patch/other/zram/lz4k/lib/* ./lib/ 2>/dev/null || true
        cp -r ../SukiSU_patch/other/zram/lz4k/crypto/* ./crypto/ 2>/dev/null || true
        [ -f ../SukiSU_patch/other/zram/zram_patch/${{ env.KERNEL_VERSION }}/lz4kd.patch ] && \
          patch -p1 -N -F 3 < ../SukiSU_patch/other/zram/zram_patch/${{ env.KERNEL_VERSION }}/lz4kd.patch || echo "âš ï¸ lz4kdè¡¥ä¸ä¸å­˜åœ¨æˆ–å·²åº”ç”¨"

    # ------------------------------------------------------------
    # 6. å†…æ ¸é…ç½®è¿½åŠ ï¼ˆé˜²é‡å¤ï¼‰
    # ------------------------------------------------------------
    - name: æ·»åŠ SUSFS é…ç½®é¡¹
      if: inputs.susfs_enable
      run: |
        cd kernel_workspace
        DEFCONFIG=./common/arch/arm64/configs/gki_defconfig
        for opt in \
          CONFIG_KSU_SUSFS=y \
          CONFIG_KSU_SUSFS_HAS_MAGIC_MOUNT=y \
          CONFIG_KSU_SUSFS_SUS_PATH=y \
          CONFIG_KSU_SUSFS_SUS_MOUNT=y \
          CONFIG_KSU_SUSFS_AUTO_ADD_SUS_KSU_DEFAULT_MOUNT=y \
          CONFIG_KSU_SUSFS_AUTO_ADD_SUS_BIND_MOUNT=y \
          CONFIG_KSU_SUSFS_SUS_KSTAT=y \
          CONFIG_KSU_SUSFS_TRY_UMOUNT=y \
          CONFIG_KSU_SUSFS_AUTO_ADD_TRY_UMOUNT_FOR_BIND_MOUNT=y \
          CONFIG_KSU_SUSFS_SPOOF_UNAME=y \
          CONFIG_KSU_SUSFS_ENABLE_LOG=y \
          CONFIG_KSU_SUSFS_HIDE_KSU_SUSFS_SYMBOLS=y \
          CONFIG_KSU_SUSFS_SPOOF_CMDLINE_OR_BOOTCONFIG=y \
          CONFIG_KSU_SUSFS_OPEN_REDIRECT=y \
          CONFIG_KSU_SUSFS_SUS_MAP=y; do
            grep -q "^$opt" "$DEFCONFIG" || echo "$opt" >> "$DEFCONFIG"
        done

    - name: æ·»åŠ  KSU & å…¶ä»–é…ç½®é¡¹
      run: |
        cd kernel_workspace
        DEFCONFIG=./common/arch/arm64/configs/gki_defconfig
        if [[ "${{ github.event.inputs.ksu_type }}" != "none" ]]; then
         grep -q "^CONFIG_KSU=y" "$DEFCONFIG" || echo "CONFIG_KSU=y" >> "$DEFCONFIG"
        fi
        if [[ "${{ github.event.inputs.kpm_enable }}" == 'builtin' && ( "${{ github.event.inputs.ksu_type }}" == "sukisu" || "${{ github.event.inputs.ksu_type }}" == "resukisu" ) ]]; then
          grep -q "^CONFIG_KPM=y" "$DEFCONFIG" || echo "CONFIG_KPM=y" >> "$DEFCONFIG"
        fi
        
        grep -q "^CONFIG_TMPFS_XATTR=y" "$DEFCONFIG" || echo "CONFIG_TMPFS_XATTR=y" >> "$DEFCONFIG"
        grep -q "^CONFIG_TMPFS_POSIX_ACL=y" "$DEFCONFIG" || echo "CONFIG_TMPFS_POSIX_ACL=y" >> "$DEFCONFIG"
        if [[ "${{ github.event.inputs.lz4kd_enable }}" == "true" ]]; then
          for opt in \
            CONFIG_ZSMALLOC=y \
            CONFIG_CRYPTO_LZ4HC=y \
            CONFIG_CRYPTO_LZ4K=y \
            CONFIG_CRYPTO_LZ4KD=y \
            CONFIG_CRYPTO_842=y; do
            grep -q "^$opt" "$DEFCONFIG" || echo "$opt" >> "$DEFCONFIG"
          done
        fi
        grep -q "^CONFIG_CC_OPTIMIZE_FOR_PERFORMANCE=y" "$DEFCONFIG" || echo "CONFIG_CC_OPTIMIZE_FOR_PERFORMANCE=y" >> "$DEFCONFIG"
        sed -i 's/check_defconfig//' ./common/build.config.gki 2>/dev/null || true
        grep -q "^CONFIG_HEADERS_INSTALL=n" "$DEFCONFIG" || echo "CONFIG_HEADERS_INSTALL=n" >> "$DEFCONFIG"

    - name: å¯ç”¨ç½‘ç»œåŠŸèƒ½å¢å¼ºä¼˜åŒ–é…ç½®
      if: inputs.better_net
      run: |
        cd kernel_workspace
        DEFCONFIG=./common/arch/arm64/configs/gki_defconfig
        cat >> "$DEFCONFIG" << 'EOF'
        CONFIG_BPF_STREAM_PARSER=y
        CONFIG_NETFILTER_XT_MATCH_ADDRTYPE=y
        CONFIG_NETFILTER_XT_SET=y
        CONFIG_IP_SET=y
        CONFIG_IP_SET_MAX=65534
        CONFIG_IP_SET_BITMAP_IP=y
        CONFIG_IP_SET_BITMAP_IPMAC=y
        CONFIG_IP_SET_BITMAP_PORT=y
        CONFIG_IP_SET_HASH_IP=y
        CONFIG_IP_SET_HASH_IPMARK=y
        CONFIG_IP_SET_HASH_IPPORT=y
        CONFIG_IP_SET_HASH_IPPORTIP=y
        CONFIG_IP_SET_HASH_IPPORTNET=y
        CONFIG_IP_SET_HASH_IPMAC=y
        CONFIG_IP_SET_HASH_MAC=y
        CONFIG_IP_SET_HASH_NETPORTNET=y
        CONFIG_IP_SET_HASH_NET=y
        CONFIG_IP_SET_HASH_NETNET=y
        CONFIG_IP_SET_HASH_NETPORT=y
        CONFIG_IP_SET_HASH_NETIFACE=y
        CONFIG_IP_SET_LIST_SET=y
        CONFIG_IP6_NF_NAT=y
        CONFIG_IP6_NF_TARGET_MASQUERADE=y
        EOF
        cd common
        [ -f ../oppo_oplus_realme_sm8750/other_patch/config.patch ] && \
          patch -p1 -N -F 3 < ../oppo_oplus_realme_sm8750/other_patch/config.patch || echo "âš ï¸ config.patch ä¸å­˜åœ¨æˆ–å·²åº”ç”¨"

    - name: æ·»åŠ  BBR ç­‰ä¸€ç³»åˆ—æ‹¥å¡æ§åˆ¶ç®—æ³•
      run: |
        if [[ "${{ github.event.inputs.bbr_enable }}" != "false" ]]; then
          cd kernel_workspace
          DEFCONFIG=./common/arch/arm64/configs/gki_defconfig
          grep -q "^CONFIG_TCP_CONG_ADVANCED=y" "$DEFCONFIG" || echo "CONFIG_TCP_CONG_ADVANCED=y" >> "$DEFCONFIG"
          grep -q "^CONFIG_TCP_CONG_BBR=y" "$DEFCONFIG" || echo "CONFIG_TCP_CONG_BBR=y" >> "$DEFCONFIG"
          grep -q "^CONFIG_TCP_CONG_CUBIC=y" "$DEFCONFIG" || echo "CONFIG_TCP_CONG_CUBIC=y" >> "$DEFCONFIG"
          grep -q "^CONFIG_TCP_CONG_VEGAS=y" "$DEFCONFIG" || echo "CONFIG_TCP_CONG_VEGAS=y" >> "$DEFCONFIG"
          grep -q "^CONFIG_TCP_CONG_NV=y" "$DEFCONFIG" || echo "CONFIG_TCP_CONG_NV=y" >> "$DEFCONFIG"
          grep -q "^CONFIG_TCP_CONG_WESTWOOD=y" "$DEFCONFIG" || echo "CONFIG_TCP_CONG_WESTWOOD=y" >> "$DEFCONFIG"
          grep -q "^CONFIG_TCP_CONG_HTCP=y" "$DEFCONFIG" || echo "CONFIG_TCP_CONG_HTCP=y" >> "$DEFCONFIG"
          grep -q "^CONFIG_TCP_CONG_BRUTAL=y" "$DEFCONFIG" || echo "CONFIG_TCP_CONG_BRUTAL=y" >> "$DEFCONFIG"
          if [[ "${{ github.event.inputs.bbr_enable }}" == "default" ]]; then
            grep -q "^CONFIG_DEFAULT_TCP_CONG=bbr" "$DEFCONFIG" || echo "CONFIG_DEFAULT_TCP_CONG=bbr" >> "$DEFCONFIG"
          else
            grep -q "^CONFIG_DEFAULT_TCP_CONG=cubic" "$DEFCONFIG" || echo "CONFIG_DEFAULT_TCP_CONG=cubic" >> "$DEFCONFIG"
          fi
        fi

    - name: å¯ç”¨ADIOS IOè°ƒåº¦å™¨
      if: inputs.adios_enable
      run: |
        cd kernel_workspace
        DEFCONFIG=./common/arch/arm64/configs/gki_defconfig
        grep -q "^CONFIG_MQ_IOSCHED_ADIOS=y" "$DEFCONFIG" || echo "CONFIG_MQ_IOSCHED_ADIOS=y" >> "$DEFCONFIG"
        grep -q "^CONFIG_MQ_IOSCHED_DEFAULT_ADIOS=y" "$DEFCONFIG" || echo "CONFIG_MQ_IOSCHED_DEFAULT_ADIOS=y" >> "$DEFCONFIG"

    - name: å¯ç”¨Re-Kernelæ”¯æŒ
      if: inputs.rekernel_enable
      run: |
        cd kernel_workspace
        DEFCONFIG=./common/arch/arm64/configs/gki_defconfig
        grep -q "^CONFIG_REKERNEL=y" "$DEFCONFIG" || echo "CONFIG_REKERNEL=y" >> "$DEFCONFIG"

    - name: å¯ç”¨å†…æ ¸çº§åŸºå¸¦ä¿æŠ¤
      if: inputs.baseband_guard
      run: |
        cd kernel_workspace
        DEFCONFIG=./common/arch/arm64/configs/gki_defconfig
        grep -q "^CONFIG_BBG=y" "$DEFCONFIG" || echo "CONFIG_BBG=y" >> "$DEFCONFIG"
        cd common
        curl -sSL https://github.com/cctv18/Baseband-guard/raw/master/setup.sh | bash
        # é˜²é‡å¤ä¿®æ”¹ LSM Kconfig
        if [ -f security/Kconfig ]; then
          if ! grep -q "baseband_guard" security/Kconfig; then
            sed -i '/^config LSM$/,/^help$/{ /^[[:space:]]*default/ { /baseband_guard/! s/selinux/selinux,baseband_guard/ } }' security/Kconfig
          fi
        fi

    - name: æ·»åŠ åˆ¶ä½œåç§°
      run: |
        cd kernel_workspace
        echo "è®¾ç½®å†…æ ¸ç‰ˆæœ¬åç¼€..."
        if [[ -n "${{ github.event.inputs.kernel_suffix }}" ]]; then
          SUFFIX="${{ github.event.inputs.kernel_suffix }}"
        else
          SUFFIX="${{ env.KERNEL_NAME }}"
        fi
        DEFCONFIG=./common/arch/arm64/configs/gki_defconfig
        echo "CONFIG_LOCALVERSION=\"-${SUFFIX}\"" >> "$DEFCONFIG"
        grep -q "^CONFIG_LOCALVERSION_AUTO=n" "$DEFCONFIG" || echo "CONFIG_LOCALVERSION_AUTO=n" >> "$DEFCONFIG"
        sed -i 's/${scm_version}//' ./common/scripts/setlocalversion 2>/dev/null || true

  # ------------------------------------------------------------
  # 7. é¢„æ¸…ç†ç¯å¢ƒ
  # ------------------------------------------------------------
    - name: é¢„æ¸…ç†ç¯å¢ƒ
      run: |
        sudo rm -rf /usr/share/dotnet /usr/local/lib/android /opt/ghc /opt/hostedtoolcache/CodeQL
        echo "ç¯å¢ƒæ¸…ç†å®Œæˆ"

  # ------------------------------------------------------------
  # 8. æ„å»ºå†…æ ¸
  # ------------------------------------------------------------
    - name: æ„å»ºå†…æ ¸
      run: |
        set -euo pipefail
        cd kernel_workspace/common

        export PATH="/usr/lib/ccache:$PATH"
        export PATH="$(pwd)/../clang18/bin:$PATH"
        CLANG_DIR="$(pwd)/../clang18/bin"
        export CCACHE_LOGFILE="${{ github.workspace }}/kernel_workspace/ccache.log"
        export CCACHE_COMPILERCHECK="none"
        export CCACHE_BASEDIR="${{ github.workspace }}"
        export CCACHE_NOHASHDIR="true"
        export CCACHE_HARDLINK="true"
        export CCACHE_DIR="${{ env.CCACHE_DIR }}"
        export CCACHE_MAXSIZE="3G"
        mkdir -p "$CCACHE_DIR"
        echo "sloppiness = file_stat_matches,include_file_ctime,include_file_mtime,pch_defines,file_macro,time_macros" >> "$CCACHE_DIR/ccache.conf"

        cat > cc-wrapper <<EOF
        #!/bin/bash
        ccache clang "\$@"
        EOF
        cat > ld-wrapper <<EOF
        #!/bin/bash
        ld.lld "\$@"
        EOF
        chmod +x cc-wrapper ld-wrapper

        export CC="$(pwd)/cc-wrapper"
        export LD="$(pwd)/ld-wrapper"
        export AR=llvm-ar
        export NM=llvm-nm
        export OBJCOPY=llvm-objcopy
        export OBJDUMP=llvm-objdump
        export STRIP=llvm-strip
        export ARCH=arm64
        export CROSS_COMPILE=aarch64-linux-gnu-

        echo "Clangç‰ˆæœ¬: $($CLANG_DIR/clang --version | head -n1)"
        echo "LLDç‰ˆæœ¬: $($CLANG_DIR/ld.lld --version | head -n1)"

        make ARCH=arm64 CC="$CC" LD="$LD" O=out gki_defconfig
        make -j$(nproc --all) ARCH=arm64 CC="$CC" LD="$LD" O=out

  # ------------------------------------------------------------
  # 9. åº”ç”¨KPMå¹¶ä¿®è¡¥å†…æ ¸
  # ------------------------------------------------------------
    - name: åº”ç”¨KPMå¹¶ä¿®è¡¥å†…æ ¸
      if: github.event.inputs.kpm_enable == 'builtin' && (github.event.inputs.ksu_type == 'sukisu' || github.event.inputs.ksu_type == 'resukisu')
      run: |
        set -euo pipefail
        cd kernel_workspace/common/out/arch/arm64/boot
        if [ -f Image ]; then
          curl -fLO https://github.com/SukiSU-Ultra/SukiSU_KernelPatch_patch/releases/latest/download/patch_linux || echo "âš ï¸ ä¸‹è½½å¤±è´¥ï¼Œè·³è¿‡KPM"
          if [ -f patch_linux ]; then
            chmod +x patch_linux
            ./patch_linux
            rm -f Image
            mv oImage Image
          else
            echo "âŒ æœªæ‰¾åˆ°patch_linuxï¼ŒKPMä¿®è¡¥è·³è¿‡"
          fi
        else
          echo "âŒ æœªæ‰¾åˆ°å†…æ ¸é•œåƒï¼ŒKPMä¿®è¡¥è·³è¿‡"
        fi

  # ------------------------------------------------------------
  # 10. å…‹éš† AnyKernel3 å¹¶æ‰“åŒ…
  # ------------------------------------------------------------
    - name: å…‹éš† AnyKernel3 å¹¶æ‰“åŒ…
      run: |
        set -euo pipefail
        cd kernel_workspace
        git clone https://github.com/cctv18/AnyKernel3 --depth=1
        rm -rf ./AnyKernel3/.git
        cd AnyKernel3
        if [ ! -f ../common/out/arch/arm64/boot/Image ]; then
          echo "âŒ æœªæ‰¾åˆ°å†…æ ¸é•œåƒæ–‡ä»¶ï¼Œæ„å»ºå¯èƒ½å‡ºé”™"
          exit 1
        fi
        cp ../common/out/arch/arm64/boot/Image ./Image

      # ç¡®å®šKSUç±»å‹åç§°
        case "${{ github.event.inputs.ksu_type }}" in
          sukisu)   KSU_TYPENAME="SukiSU" ;;
          resukisu) KSU_TYPENAME="ReSukiSU" ;;
          ksunext)  KSU_TYPENAME="KSUNext" ;;
          mksu)     KSU_TYPENAME="MKSU" ;;
          ksu)      KSU_TYPENAME="KSU" ;;
          *)        KSU_TYPENAME="none" ;;
        esac

        if [[ -n "${{ github.event.inputs.kernel_suffix }}" ]]; then
          zip -r "../AnyKernel3_${KSU_TYPENAME}_${{ env.KSUVER }}_${{ env.KERNEL_VERSION }}_A15_${{ github.event.inputs.kernel_suffix }}.zip" ./*
        else
          zip -r "../AnyKernel3_${KSU_TYPENAME}_${{ env.KSUVER }}_${{ env.KERNEL_VERSION }}_A15_${{ env.KERNEL_NAME }}.zip" ./*
        fi

  # ------------------------------------------------------------
  # 11. ä¸Šä¼  Ccache è°ƒè¯•æ—¥å¿—ï¼ˆå¯é€‰ï¼‰
  # ------------------------------------------------------------
    - name: ä¸Šä¼  Ccache è°ƒè¯•æ—¥å¿—
      if: always() && inputs.ccache_debug
      uses: actions/upload-artifact@v4
      with:
        name: ccache-debug-log
        path: ${{ github.workspace }}/kernel_workspace/ccache.log

    - name: ä¸Šä¼  ZIP å·¥ä»¶
      uses: actions/upload-artifact@v4
      with:
        name: Kernel_ZIP_${{ github.run_id }}
        path: ${{ github.workspace }}/kernel_workspace/AnyKernel*.zip
        retention-days: 30
        compression-level: 9
      
release:
  needs: build
  runs-on: ubuntu-latest
  permissions:
    contents: write
    packages: write
    actions: read
      
  steps:
      - name: ä¸‹è½½ ZIP å·¥ä»¶
        uses: actions/download-artifact@v4
        with:
          # FIX #5: ä¿®å¤å·¥ä»¶åç§°ä¸åŒ¹é…
          name: Kernel_ZIP_${{ github.run_id }}
          path: ./release_zips

      - name: è®¾ç½®ç¯å¢ƒå˜é‡
        run: |
          if [[ -n "${{ github.event.inputs.kernel_suffix }}" ]]; then
            FULL_VERSION=${{ format('{0}.89-{1}', env.KERNEL_VERSION, github.event.inputs.kernel_suffix) }}
            echo "FULL_VERSION=$FULL_VERSION" >> $GITHUB_ENV
            export FULL_VERSION=$FULL_VERSION
          else
            FULL_VERSION=${{ format('{0}.89-{1}', env.KERNEL_VERSION, env.KERNEL_NAME) }}
            echo "FULL_VERSION=$FULL_VERSION" >> $GITHUB_ENV
            export FULL_VERSION=$FULL_VERSION
          fi
          TIME="$(TZ='Asia/Shanghai' date +'%y%m%d%H%M%S')"
          TIME_FORM="$(TZ='Asia/Shanghai' date +'%Y-%m-%d %H:%M:%S')"
          echo "TIME=$TIME" >> $GITHUB_ENV
          echo "TIME_FORM=$TIME_FORM" >> $GITHUB_ENV
          TAG_HEAD="OPPO+OPlus+Realme-A15-build"
          echo "TAG_HEAD=$TAG_HEAD" >> $GITHUB_ENV
          if [[ ${{ github.event.inputs.ksu_type }} == "sukisu" ]]; then
            KSU_TYPENAME="SukiSU Ultra"
          elif [[ ${{ github.event.inputs.ksu_type }} == "resukisu" ]]; then
            KSU_TYPENAME="ReSukiSU"
          elif [[ ${{ github.event.inputs.ksu_type }} == "ksunext" ]]; then
            KSU_TYPENAME="KernelSU Next"
          elif [[ ${{ github.event.inputs.ksu_type }} == "mksu" ]]; then
            KSU_TYPENAME="MKSU"
          elif [[ ${{ github.event.inputs.ksu_type }} == "ksu" ]]; then
            KSU_TYPENAME="KSU"
          else
            KSU_TYPENAME="æ— å†…ç½®KSU"
          fi
          echo "KSU_TYPENAME=$KSU_TYPENAME" >> $GITHUB_ENV

      # æ·»åŠ æ„å»ºæ—¥å¿—æ”¶é›†
      - name: æ”¶é›†æ„å»ºæ—¥å¿—
        if: always()
        run: |
          mkdir -p ./build-logs
          cp ${{ github.workspace }}/kernel_workspace/ccache.log ./build-logs/ 2>/dev/null || true
          cp ${{ github.workspace }}/kernel_workspace/common/out/arch/arm64/boot/.config ./build-logs/ 2>/dev/null || true
          tar -czf build-logs.tar.gz ./build-logs/

      - name: ä¸Šä¼ æ„å»ºæ—¥å¿—
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: Build_Logs
          path: build-logs.tar.gz
          retention-days: 7
    
      - name: åˆ›å»ºå‘å¸ƒ
        id: create_release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: "${{ env.TAG_HEAD }}-${{ env.TIME }}"
          name: "${{ env.TAG_HEAD }}-${{ env.FULL_VERSION }}"
          body: |
            ### ğŸ“± æ¬§åŠ çœŸ ${{ env.KSU_TYPENAME }} SM8750 é€šç”¨å†…æ ¸ | æ„å»ºä¿¡æ¯
            - å†…æ ¸ç‰ˆæœ¬å·: ${{ env.FULL_VERSION }}
            - ç¼–è¯‘æ—¶é—´: ${{ env.TIME_FORM }}
            - æœºå‹ï¼šæ¬§åŠ çœŸéªé¾™8Eliteé€šç”¨ 6.6.89 å†…æ ¸ï¼ˆåŸºäºä¸€åŠ 13å›½é™…ç‰ˆ 6.6.89 ç‰ˆå®˜æ–¹OKIæºç ï¼‰
            - ç‰¹æ€§ï¼š${{ env.KSU_TYPENAME }} + é£é©°å†…æ ¸
            - susfsæ”¯æŒï¼š${{ github.event.inputs.susfs_enable }}
            - KPMæ”¯æŒ ï¼š${{ github.event.inputs.kpm_enable }}
            - LZ4æ”¯æŒï¼š${{ github.event.inputs.lz4_enable }}
            - LZ4KDæ”¯æŒï¼š${{ github.event.inputs.lz4kd_enable }}
            - ç½‘ç»œåŠŸèƒ½å¢å¼ºï¼š${{ github.event.inputs.better_net }}
            - BBR/Brutal ç­‰æ‹¥å¡æ§åˆ¶ç®—æ³•æ”¯æŒï¼š${{ github.event.inputs.bbr_enable }}
            - ADIOS IOè°ƒåº¦å™¨æ”¯æŒï¼š${{ github.event.inputs.adios_enable }}
            - Re-Kernelæ”¯æŒï¼š${{ github.event.inputs.rekernel_enable }}
            - å†…æ ¸çº§åŸºå¸¦ä¿æŠ¤æ”¯æŒï¼š${{ github.event.inputs.baseband_guard }}
            - SukiSU Ultraç®¡ç†å™¨ä¸‹è½½ï¼š[SukiSU-Ultra](https://github.com/SukiSU-Ultra/SukiSU-Ultra/releases)
            - KernelSU Nextç®¡ç†å™¨ä¸‹è½½ï¼š[KernelSU-Next](https://github.com/KernelSU-Next/KernelSU-Next/releases)
            - MKSUç®¡ç†å™¨ä¸‹è½½ï¼š[Magic-KernelSU](https://github.com/5ec1cff/KernelSU/actions)
            - KSUåŸç‰ˆç®¡ç†å™¨ä¸‹è½½ï¼š[KernelSU](https://github.com/tiann/KernelSU/releases)
            ### â«ï¸ æ›´æ–°å†…å®¹ï¼š
            - æ›´æ–°${{ env.KSU_TYPENAME }}è‡³æœ€æ–°ç‰ˆæœ¬ï¼ˆ${{ needs.build.outputs.ksuver }}ï¼‰
            - (é¢„ç•™)
            ### ğŸ“‹ å®‰è£…æ–¹æ³• | Installation Guide
            1. è‹¥ä½ çš„æ‰‹æœºå·²ç»å®‰è£…äº†ç¬¬ä¸‰æ–¹Recoveryï¼ˆå¦‚TWRP)ï¼Œå¯ä¸‹è½½å¯¹åº”æœºå‹çš„AnyKernelåˆ·æœºåŒ…åè¿›å…¥Recoveryæ¨¡å¼ï¼Œé€šè¿‡Recoveryåˆ·å…¥åˆ·æœºåŒ…åé‡å¯è®¾å¤‡ï¼›
            2. è‹¥ä½ çš„æ‰‹æœºä¹‹å‰å·²æœ‰ root æƒé™ï¼Œå¯åœ¨æ‰‹æœºä¸Šå®‰è£…[HorizonKernelFlasher](https://github.com/libxzr/HorizonKernelFlasher/releases)ï¼Œåœ¨HorizonKernelFlasherä¸­åˆ·å…¥AnyKernelåˆ·æœºåŒ…å¹¶é‡å¯ï¼›
            3. è‹¥ä½ ä¹‹å‰å·²åˆ·å…¥SukiSU Ultraå†…æ ¸ï¼Œä¸”SukiSU Ultraç®¡ç†å™¨å·²æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬ï¼Œå¯åœ¨SukiSU Ultraç®¡ç†å™¨ä¸­ç›´æ¥åˆ·å…¥AnyKernelåˆ·æœºåŒ…å¹¶é‡å¯ï¼›
            4. åˆ·å…¥æ— lz4kdè¡¥ä¸ç‰ˆçš„å†…æ ¸å‰è‹¥åˆ·å…¥è¿‡lz4kdè¡¥ä¸ç‰ˆçš„å†…æ ¸ï¼Œä¸ºé¿å…å‡ºé”™ï¼Œè¯·å…ˆå…³é—­zramæ¨¡å—ï¼›
            5. ç”±äºKernelSUä¸Šæ¸¸æ›´æ–°äº†å…ƒæ¨¡å—åŠŸèƒ½ï¼Œæœ€æ–°ç‰ˆKSUç®¡ç†å™¨ï¼ˆåŒ…æ‹¬é™¤KernelSU Nextä»¥å¤–çš„å„åˆ†æ”¯ï¼‰éœ€è¦é…åˆå…ƒæ¨¡å—(metamodule)æ‰èƒ½æ­£å¸¸æŒ‚è½½æ¨¡å—ã€‚
            6. KernelPatch Nextï¼ˆå³KPNï¼‰æ˜¯ä¸€ä¸ªç‹¬ç«‹äºKSUçš„KPMå®ç°ï¼Œå¯ä»¥è¿è¡Œåœ¨ä»»æ„KSU/é¢å…·ç¯å¢ƒä¸­ã€‚
            #### â€»â€»â€»åˆ·å†™å†…æ ¸æœ‰é£é™©ï¼Œä¸ºé˜²æ­¢å‡ºç°æ„å¤–å¯¼è‡´æ‰‹æœºå˜ç –ï¼Œåœ¨åˆ·å…¥å†…æ ¸å‰è¯·åŠ¡å¿…ç”¨[KernelFlasher](https://github.com/capntrips/KernelFlasher)ç­‰è½¯ä»¶å¤‡ä»½bootç­‰å…³é”®å¯åŠ¨åˆ†åŒº!â€»â€»â€»
          draft: false
          prerelease: false
          files: |
            release_zips/AnyKernel3_*.zip   
